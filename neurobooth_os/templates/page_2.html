<div>
    <div class="container" id="content-container">
        <div class="mb-3">
            <div class="row">
                <div class="col">
                    <label for="subject_label" class="col-sm-2 col-form-label">Subject</label>
                    <input type="text" class="form-control" id="subject_label" value={{subject}} readonly>
                </div>
                <div class="col">
                    <label for="staff_label" class="col-sm-2 col-form-label">Staff ID</label>
                    <input type="text" class="form-control" id="staff_label" value={{staff_id}} readonly>
                </div>
            </div>
        </div>
        <form>
            <div class="p-3 mb-3 bg-light">
                <div class="mb-3">
                    <label for="notes-text-area" class="form-label">RC Notes</label>
                    <textarea class="form-control" id="notes-text-area" rows="3" autofocus></textarea>
                </div>

                <div class="mb-3">
                    <label for="notes-task" class="form-label">Task</label>
                    <select class="form-select" id="notes-task" aria-label="Select task for notes">
                        <option selected>All tasks</option>
                        {% for task in tasks %}
                        <option value="{{task}}">{{task}}</option>
                        {% endfor %}
                    </select>
                </div>
                <button type="button" class="btn btn-primary" id="save_notes_btn">Save notes</button>

            </div>
        </form>

    </div>
    <div class="btn-toolbar mb-3" role="toolbar">
        <div class="btn-group me-2" role="group">
            <button type="button" class="btn btn-primary" id="init_servers_btn">1. Initiate servers</button>
        </div>
        <div class="btn-group me-2" role="group">
            <button type="button" class="btn btn-primary" id="connect_devices_btn" disabled>2. Connect devices</button>
        </div>
        <div class="btn-group me-2" role="group">
            <button type="button" class="btn btn-primary" id="start_session_btn" disabled>3. Start</button>
        </div>
    </div>
    <div class="btn-toolbar" role="toolbar">
        <div class="btn-group me-2" role="group">
            <button type="button" class="btn btn-warning" id="pause_session">Pause session</button>
        </div>
        <div class="btn-group me-2" role="group">
            <button type="button" class="btn btn-danger" id="term_servers_btn">Terminate servers</button>
        </div>
    </div>
    <div class = mt-3 id="console">
        <div class="mb-3">
            <label for="console-text-area" class="form-label">Console</label>
            <textarea class="form-control" id="console-text-area" rows="10" readonly></textarea>
        </div>
    </div>
    <script lang="javascript">

    // On Save Notes click, update session state and replace div with new content
    $('#save_notes_btn').click(function() {
        const save_notes_url = 'http://127.0.0.1:8082/save_notes';
        const json_data = {};
        json_data['note_task'] = $("#notes-task").val();
        json_data['note_text'] = $("#notes-text-area").val();
        $.ajax({
            type: 'GET',
            url:save_notes_url,
            data: jQuery.param(json_data),
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            success: function (response) {
                $("#notes-text-area").val("");
            },
            error: function(xhr) {
                alert("An error occurred: " + xhr.status + " " + xhr.statusText);
            }
            });
        });


    // initiate servers click
    $('#init_servers_btn').click(function() {
        const init_url = 'http://127.0.0.1:8082/start_servers';

        const json_data = {}
        json_data['staff_id'] = $staff_id_input.val();
        json_data['subj_id'] = $subj_id_input.val();
        json_data['study_id'] = $study_select.val();
        json_data['collection_id'] = $col_select.val();
        checked_tasks = [];

        $('.task-check:checkbox:checked').each(function () {
            v = $(this).prop('id').replace('check-', '');
            checked_tasks.push(v);
        })
        json_data['tasks'] = checked_tasks;

        $.ajax({
            type: 'GET',
            url:init_url,
            // data: jQuery.param(json_data),
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            success: function (response) {
                $('#connect_devices_btn').prop("disabled", false);
                $('#init_servers_btn').prop("disabled", true);
              },
            error: function(xhr) {
                alert("An error occurred: " + xhr.status + " " + xhr.statusText);
            }
            });
        });

    // connect devices click
    $('#connect_devices_btn').click(function() {
        const connect_url = 'http://127.0.0.1:8082/connect_devices';

        $.ajax({
            type: 'GET',
            url:connect_url,
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            success: function (response) {
                $('#connect_devices_btn').prop("disabled", true);
                $('#start_session_btn').prop("disabled", false);
              },
            error: function(xhr) {
                alert("An error occurred: " + xhr.status + " " + xhr.statusText);
            }
            });
        });

    // start_session click
    $('#start_session_btn').click(function() {
        const connect_url = 'http://127.0.0.1:8082/start_session';

        $.ajax({
            type: 'GET',
            url:connect_url,
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            success: function (response) {
                $('#start_session_btn').prop("disabled", true);
                console.log(response)
              },
            error: function(xhr) {
                alert("An error occurred: " + xhr.status + " " + xhr.statusText);
            }
            });
        });

    // terminate_servers click
    $('#term_servers_btn').click(function() {
        const connect_url = 'http://127.0.0.1:8082/terminate_servers';

        $.ajax({
            type: 'GET',
            url:connect_url,
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            success: function (response) {
                $('#terminate_servers_btn').prop("disabled", true);
                console.log(response)
              },
            error: function(xhr) {
                alert("An error occurred: " + xhr.status + " " + xhr.statusText);
            }
            });
        });

    </script>
</div>